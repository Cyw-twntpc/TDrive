/* [MODIFIED] 傳輸面板與 Modal 樣式 */

/* --- 側邊欄傳輸狀態區塊 (新設計 - 左右分割) --- */
.sidebar-transfer-status {
    border-top: 1px solid var(--border-color);
    padding: 4px; /* Reduced from 8px */
    margin-top: auto; /* 推到底部 */
    cursor: pointer;
    transition: background-color 0.2s;
    user-select: none;
    display: flex; /* 改為 Flex 佈局 */
    align-items: stretch; /* 讓子元素填滿高度 */
    height: 50px; /* Reduced from 60px */
    gap: 6px; /* Reduced from 8px */
}

.sidebar-transfer-status:hover {
    background-color: rgba(0, 0, 0, 0.02);
}

/* 左側：大圖示區塊 */
.sidebar-transfer-left {
    flex-shrink: 0;
    width: 36px; /* Reduced from 40px */
    display: flex;
    align-items: center;
    justify-content: center;
    background-color: rgba(var(--primary-color-rgb), 0.1); /* 輕微背景色 */
    border-radius: 4px; /* Slightly reduced radius */
}

.transfer-icon-wrapper {
    color: var(--primary-color);
    font-size: 20px; /* Reduced from 24px */
    transition: color 0.3s ease;
    width: 24px;   /* Explicit width */
    height: 24px;  /* Explicit height is required when <i> is hidden */
    display: flex;
    align-items: center;
    justify-content: center;
    /* Default (Idle) State Image */
    background-image: url('../../img/transfer.png');
    background-size: contain;
    background-repeat: no-repeat;
    background-position: center;
}

/* 混合傳輸狀態：顯示 GIF 動畫 */
.transfer-active.mixed-active .transfer-icon-wrapper {
    background-image: url('../../img/sync.gif');
}

/* 上傳狀態：顯示 GIF 動畫 */
.transfer-active.upload-active .transfer-icon-wrapper {
    background-image: url('../../img/upload.gif');
}

/* 下載狀態：顯示 GIF 動畫 */
.transfer-active.download-active .transfer-icon-wrapper {
    background-image: url('../../img/download.gif');
}

@keyframes slow-spin {
    from { transform: rotate(0deg); }
    to { transform: rotate(360deg); }
}

/* 右側：資訊區塊 */
.sidebar-transfer-right {
    flex-grow: 1;
    display: flex;
    flex-direction: column;
    justify-content: center;
    overflow: hidden; /* 防止文字溢出 */
    padding-bottom: 2px; /* 預留底部空間 */
}

.transfer-info-row {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 0;
    line-height: 1.2;
    height: 16px; /* Fixed height to prevent layout shift */
}

#sidebar-transfer-title {
    font-size: 12px; /* Reduced from 13px */
    color: var(--text-color);
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
}

#sidebar-transfer-speed {
    font-size: 10px; /* Reduced from 11px for better hierarchy */
    color: var(--text-light-color);
}

.sidebar-progress-container {
    height: 4px;
    background-color: #e9eef5; /* 更淡的灰色軌道 */
    border-radius: 2px;
    overflow: hidden;
    width: 100%;
    margin-top: 3px; /* Reduced/Adjusted */
    flex-shrink: 0; /* 防止被壓縮 */
}

.sidebar-progress-fill {
    height: 100%;
    background-color: transparent;
    width: 100%; /* Full width, controlled by scaleX */
    transform: scaleX(0); /* Initial state */
    transform-origin: left; /* Grow from left */
    transition: transform 0.15s linear, background-color 0.3s ease; /* 0.15s < 0.2s interval to avoid conflict */
    border-radius: 2px;
}

/* 狀態顏色變化 - 改變 icon 顏色與進度條顏色 */
.sidebar-transfer-status.transfer-active .sidebar-progress-fill,
.sidebar-transfer-status.transfer-active.upload-active .sidebar-progress-fill,
.sidebar-transfer-status.transfer-active.download-active .sidebar-progress-fill,
.sidebar-transfer-status.transfer-active.mixed-active .sidebar-progress-fill { 
    background-color: var(--primary-color) !important; 
}

.sidebar-transfer-status.status-completed .sidebar-progress-fill { background-color: var(--success-color); width: 100% !important; }
.sidebar-transfer-status.status-failed .sidebar-progress-fill { background-color: var(--danger-color); }

/* 完成狀態：顯示圖片 */
.status-completed .transfer-icon-wrapper {
    background-image: url('../../img/done.png');
}
.status-completed .sidebar-transfer-left { background-color: rgba(var(--success-color-rgb), 0.1); }

/* 失敗狀態：顯示圖片 */
.status-failed .transfer-icon-wrapper {
    background-image: url('../../img/error.png');
}
.status-failed .sidebar-transfer-left { background-color: rgba(var(--danger-color-rgb), 0.1); }


/* --- 傳輸詳細資訊 Modal 樣式 (保留並優化) --- */
.modal-tabs { display: flex; border-bottom: 1px solid var(--border-color); padding: 0 24px; }
.tab-btn { background: none; border: none; padding: 14px 16px; font-size: 16px; cursor: pointer; position: relative; color: var(--text-light-color); }
.tab-btn.active { color: var(--primary-color); font-weight: 700; }
.tab-btn.active::after { content: ''; position: absolute; bottom: -1px; left: 0; right: 0; height: 3px; background-color: var(--primary-color); }
.tab-btn span { background: #e9eef5; color: var(--text-light-color); padding: 2px 8px; border-radius: 12px; font-size: 12px; margin-left: 8px; }
.tab-btn.active span { background: var(--selected-bg-color); color: var(--primary-color); }
.tab-content { display: none; padding: 8px 24px 24px 24px; }
.tab-content.active { display: block; }
.transfer-list { max-height: 45vh; overflow-y: auto; }
.empty-list-msg { padding: 20px; text-align: center; color: var(--text-light-color); }
.transfer-item { display: flex; align-items: center; padding: 12px 0; border-bottom: 1px solid var(--border-color); }
.transfer-item:last-child { border-bottom: none; }
.transfer-item .file-icon { font-size: 24px; margin-right: 16px; width: 30px; text-align: center; color: var(--text-light-color); }
.item-info { flex-grow: 1; }
.item-name { font-weight: 500; }
.item-details { font-size: 12px; color: var(--text-light-color); display: flex; gap: 12px; margin-top: 4px; }
.item-progress-bar { height: 6px; background: #e9eef5; border-radius: 3px; margin-top: 6px; overflow: hidden; }
.item-progress-bar .progress-fill { width: 0%; height: 100%; background-color: var(--primary-color); border-radius: 3px; transition: width 0.2s linear; }
.item-status { font-size: 24px; margin: 0 16px; color: var(--text-light-color); display: flex; align-items: center; justify-content: center; }
.item-status .fa-check-circle { color: var(--success-color); }
.item-status .fa-exclamation-circle { color: var(--danger-color); }
.item-status .fa-spin { animation: spin 1.5s linear infinite; }
.item-actions { display: flex; gap: 4px; }
.item-actions .action-btn { background-color: #f0f2f5; border: none; width: 32px; height: 32px; border-radius: 50%; font-size: 14px; cursor: pointer; color: var(--text-light-color); display: flex; align-items: center; justify-content: center; }
.item-actions .action-btn:hover { background-color: #e1e4e8; }

.transfer-item .pause-item, .transfer-item .resume-item, .transfer-item .retry-item, .transfer-item .cancel-item { display: none; }
.transfer-item[data-status="transferring"] .pause-item, .transfer-item[data-status="transferring"] .cancel-item { display: flex; }
.transfer-item[data-status="paused"] .resume-item, .transfer-item[data-status="paused"] .cancel-item { display: flex; }
.transfer-item[data-status="failed"] .retry-item, .transfer-item[data-status="failed"] .cancel-item { display: flex; }
.transfer-item[data-status="queued"] .cancel-item { display: flex; }

/* --- 傳輸管理器樹狀視圖樣式 --- */
.transfer-item .item-indent {
    flex-shrink: 0;
}
.transfer-item .item-toggle {
    width: 16px;
    height: 16px;
    flex-shrink: 0;
    margin-right: 4px;
    color: var(--text-light-color);
    display: flex;
    align-items: center;
    justify-content: center;
    transition: transform 0.2s ease-in-out;
}
.transfer-item .item-toggle i {
    transition: transform 0.2s ease-in-out;
}
.transfer-item .item-toggle .fa-caret-right {
    transform: rotate(-90deg);
}